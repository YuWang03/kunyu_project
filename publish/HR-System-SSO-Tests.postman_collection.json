{
  "info": {
    "name": "HR System API - SSO Tests",
    "description": "HR System API SSO 功能測試集合",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5147",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. 帳號狀態檢核",
      "item": [
        {
          "name": "檢查可用帳號狀態",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Auth/check-status?uid=E001",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "check-status"],
              "query": [
                {
                  "key": "uid",
                  "value": "E001",
                  "description": "員工工號"
                }
              ]
            },
            "description": "需求4: 檢核帳號狀態 API\n\n回傳欄位:\n- uid: 員工工號\n- isActive: 是否可使用\n- status: W/S/X\n- statusName: 使用/停用/永久停權"
          },
          "response": []
        },
        {
          "name": "檢查不存在的帳號",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Auth/check-status?uid=NOTEXIST",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "check-status"],
              "query": [
                {
                  "key": "uid",
                  "value": "NOTEXIST"
                }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "2. 登入功能",
      "item": [
        {
          "name": "登入 - 成功",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// 儲存 Token ID 供後續測試使用",
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.environment.set('tokenId', jsonData.tokenId);",
                  "    pm.environment.set('uid', jsonData.uid);",
                  "    ",
                  "    // 驗證必要欄位",
                  "    pm.test('包含 Token ID', function() {",
                  "        pm.expect(jsonData.tokenId).to.exist;",
                  "    });",
                  "    ",
                  "    pm.test('包含 uid (員工工號)', function() {",
                  "        pm.expect(jsonData.uid).to.exist;",
                  "    });",
                  "    ",
                  "    pm.test('包含 isActive', function() {",
                  "        pm.expect(jsonData.isActive).to.be.a('boolean');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@company.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "login"]
            },
            "description": "需求1, 2, 3:\n1. 產生 Token ID (格式: nn+ssssss+nn)\n2. 驗證帳號是否可使用 (uwork='W')\n3. 回傳 uid (員工工號)"
          },
          "response": []
        },
        {
          "name": "登入 - 帳號停用",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"disabled@company.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "login"]
            },
            "description": "測試帳號停用時無法登入 (uwork!='W')"
          },
          "response": []
        }
      ]
    },
    {
      "name": "3. Token 驗證",
      "item": [
        {
          "name": "驗證有效 Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tokenId\": \"{{tokenId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Auth/validate-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "validate-token"]
            },
            "description": "需求1: 驗證 Token ID 是否有效\n\n使用從登入 API 取得的 tokenId"
          },
          "response": []
        },
        {
          "name": "驗證無效 Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tokenId\": \"0000000000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Auth/validate-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "validate-token"]
            },
            "description": "測試無效的 Token ID"
          },
          "response": []
        }
      ]
    },
    {
      "name": "4. 使用者資訊",
      "item": [
        {
          "name": "取得使用者資訊",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Auth/userinfo?email=test@company.com",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "userinfo"],
              "query": [
                {
                  "key": "email",
                  "value": "test@company.com"
                }
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "5. 外出單測試",
      "item": [
        {
          "name": "測試 FTP 連線",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/OutingForm/test-ftp",
              "host": ["{{baseUrl}}"],
              "path": ["api", "OutingForm", "test-ftp"]
            }
          },
          "response": []
        },
        {
          "name": "申請外出單",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "Email",
                  "value": "test@company.com",
                  "type": "text"
                },
                {
                  "key": "Type",
                  "value": "外出",
                  "type": "text"
                },
                {
                  "key": "Date",
                  "value": "2025-11-03",
                  "type": "text"
                },
                {
                  "key": "StartTime",
                  "value": "2025-11-03T09:00:00",
                  "type": "text"
                },
                {
                  "key": "EndTime",
                  "value": "2025-11-03T12:00:00",
                  "type": "text"
                },
                {
                  "key": "Location",
                  "value": "客戶辦公室",
                  "type": "text"
                },
                {
                  "key": "Reason",
                  "value": "拜訪客戶",
                  "type": "text"
                },
                {
                  "key": "ReturnToOffice",
                  "value": "true",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/OutingForm/apply",
              "host": ["{{baseUrl}}"],
              "path": ["api", "OutingForm", "apply"]
            }
          },
          "response": []
        },
        {
          "name": "查詢待簽核外出單",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/OutingForm/pending?ApproverEmail=manager@company.com",
              "host": ["{{baseUrl}}"],
              "path": ["api", "OutingForm", "pending"],
              "query": [
                {
                  "key": "ApproverEmail",
                  "value": "manager@company.com"
                }
              ]
            }
          },
          "response": []
        }
      ]
    }
  ]
}
